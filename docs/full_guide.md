# Movie Debate Agent: Complete 3-Hour Build Guide

**Copy-paste-into-Notion (or your Cursor "/plan" file) build guide** that an LLM coding agent can follow start-to-finish in a 3-hour hackathon sprint.

---

## üéØ Project North-Star

| Goal | Why it matters |
|------|----------------|
| **Subjective consensus on "maximum happiness" for four people, expressed as a single movie title** | Shows off RAG + multi-agent reasoning in an instantly relatable domain |
| **Live MCP reasoning stream in the UI** | Gives judges a "wow" moment: you can *see* each agent thinking |
| **One-command boot (`docker compose up --build`)** | Passes the portability test; no local setup drama |
| **Heavy Magic MCP integration** | Autogens UI components directly in Cursor IDE |
| **LangChain + MCP architecture** | Required: All agent logic uses LangChain with MCP protocol |

---

## üèóÔ∏è High-Level System Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   WebSocket/SSE   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Next.js 15 UI ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ FastAPI 1.4    ‚îÇ
‚îÇ (Magic MCP)   ‚îÇ                   ‚îÇ  ‚Ä¢ LangChain   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ  ‚Ä¢ MCP server  ‚îÇ
     ‚ñ≤  ‚ñ≤   ‚ñ≤                       ‚îÇ  ‚Ä¢ Debate loop ‚îÇ
     ‚îÇ  ‚îÇ   ‚îÇ                       ‚îÇ  ‚Ä¢ Faiss index ‚îÇ
     ‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ REST: /start, /status, /db-embed --->‚îê
     ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Faiss vectors over HTTP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Facebook AI Faiss (in-memory) ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Core Technology Stack
- **MCP layer** (in FastAPI) exposes each tool: `vector.search`, `openai.chat`, `timer.guard`
- **Magic MCP** autogenerates cards, modals, toasts, and navigation components directly in Cursor
- **LangChain** handles all agent logic, chains, and tool orchestration (REQUIRED)
- **Faiss** (Facebook AI) stores 768-dim sentence-transformer embeddings in-memory (FREE!)
- **MCP protocol** streams all tool calls and agent thoughts to UI in real-time

---

## üìÅ Complete Repository Layout

```
root/
‚îú‚îÄ .env.example              # Copy to .env before running
‚îú‚îÄ docker-compose.yml        # Single command deployment
‚îú‚îÄ README.md                 # High-level usage notes
‚îÇ
‚îú‚îÄ backend/
‚îÇ  ‚îú‚îÄ Dockerfile
‚îÇ  ‚îú‚îÄ pyproject.toml         # Poetry: langchain, faiss-cpu, fastapi, uvicorn
‚îÇ  ‚îú‚îÄ requirements.txt       # Fallback for Docker
‚îÇ  ‚îú‚îÄ app/
‚îÇ  ‚îÇ  ‚îú‚îÄ main.py             # FastAPI factory, MCP routes
‚îÇ  ‚îÇ  ‚îú‚îÄ mcp_tools/          # REQUIRED: MCP-wrapped tools
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ vector_search.py # FaissVectorSearchTool
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ openai_chat.py   # OpenAIChatTool
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ timer_guard.py   # TimerGuardTool
‚îÇ  ‚îÇ  ‚îú‚îÄ agents/             # LangChain agent definitions
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ agent_lawyer.py  # Individual debate agent
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ orchestrator.py  # Multi-agent coordinator
‚îÇ  ‚îÇ  ‚îú‚îÄ chains/             # LangChain chain definitions
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ profile_chain.py # User profile ‚Üí structured JSON
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ elimination_chain.py # Debate & movie elimination
‚îÇ  ‚îÇ  ‚îú‚îÄ vector/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ faiss_store.py   # Faiss index management
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ embeddings.py    # Sentence transformer wrapper
‚îÇ  ‚îÇ  ‚îú‚îÄ models/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ movie.py         # Pydantic movie models
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ session.py       # Session & profile models
‚îÇ  ‚îÇ  ‚îú‚îÄ utils/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ __init__.py
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ pairing.py       # Round-robin debate pairing
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ scoring.py       # Happiness scoring logic
‚îÇ  ‚îÇ  ‚îî‚îÄ tests/              # pytest (optional)
‚îÇ  ‚îî‚îÄ scripts/
‚îÇ     ‚îú‚îÄ __init__.py
‚îÇ     ‚îú‚îÄ build_faiss_index.py # One-time: movies ‚Üí Faiss index
‚îÇ     ‚îî‚îÄ sample_movies.py     # Sample dataset generator
‚îÇ
‚îú‚îÄ frontend/
‚îÇ  ‚îú‚îÄ Dockerfile
‚îÇ  ‚îú‚îÄ next.config.mjs
‚îÇ  ‚îú‚îÄ tailwind.config.ts
‚îÇ  ‚îú‚îÄ package.json           # pnpm workspace
‚îÇ  ‚îú‚îÄ pnpm-lock.yaml
‚îÇ  ‚îî‚îÄ src/
‚îÇ     ‚îú‚îÄ pages/
‚îÇ     ‚îÇ  ‚îî‚îÄ index.tsx        # Main debate interface
‚îÇ     ‚îú‚îÄ components/         # Generated by Magic MCP
‚îÇ     ‚îÇ  ‚îú‚îÄ MagicCard.tsx    # User profile cards
‚îÇ     ‚îÇ  ‚îú‚îÄ UserModal.tsx    # Profile input modal
‚îÇ     ‚îÇ  ‚îú‚îÄ AgentStream.tsx  # Live reasoning display
‚îÇ     ‚îÇ  ‚îú‚îÄ ToastProvider.tsx # Round notifications
‚îÇ     ‚îÇ  ‚îú‚îÄ PillNavbar.tsx   # Bottom navigation
‚îÇ     ‚îÇ  ‚îî‚îÄ ConsensusPanel.tsx # Final result display
‚îÇ     ‚îú‚îÄ hooks/
‚îÇ     ‚îÇ  ‚îú‚îÄ useEventSource.ts # MCP event streaming
‚îÇ     ‚îÇ  ‚îî‚îÄ useToast.ts      # Toast notifications
‚îÇ     ‚îú‚îÄ lib/
‚îÇ     ‚îÇ  ‚îú‚îÄ api.ts           # Typed fetch wrappers
‚îÇ     ‚îÇ  ‚îî‚îÄ types.ts         # TypeScript definitions
‚îÇ     ‚îî‚îÄ styles/
‚îÇ        ‚îî‚îÄ globals.css      # Tailwind + custom styles
‚îÇ
‚îî‚îÄ docs/                     # Optional architecture diagrams
   ‚îú‚îÄ architecture.md
   ‚îî‚îÄ mcp-flow.md
```

---

## üîß Core Technology Requirements

### Backend Dependencies (pyproject.toml)
```toml
[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.104.0"
uvicorn = "^0.24.0"
langchain = "^0.1.0"              # REQUIRED: All agent logic
langchain-openai = "^0.0.5"       # REQUIRED: OpenAI integration
langchain-community = "^0.0.10"   # REQUIRED: Community tools
mcp = "^0.3.0"                    # REQUIRED: Model Context Protocol
faiss-cpu = "^1.7.4"             # Facebook AI vector search (FREE)
sentence-transformers = "^2.2.2"  # Text embeddings
pydantic = "^2.5.0"              # Data validation
numpy = "^1.24.0"                # Faiss dependency
```

### Frontend Dependencies (package.json)
```json
{
  "dependencies": {
    "next": "^15.0.0",
    "react": "^18.2.0",
    "typescript": "^5.0.0",
    "tailwindcss": "^3.4.0",
    "framer-motion": "^10.16.0",
    "@radix-ui/react-dialog": "^1.0.5",
    "lucide-react": "^0.263.1"
  }
}
```

---

## üóÑÔ∏è Data Layer: Faiss Vector Store

### Movie Data Structure
```python
@dataclass
class Movie:
    id: int
    title: str
    overview: str
    tags: List[str]          # ["time-travel", "high-energy", "kids-friendly"]
    embedding: np.ndarray    # 768-dim sentence-transformer embedding
    happiness_score: float   # Pre-computed base score
```

### Faiss Index Setup
```python
# scripts/build_faiss_index.py
import faiss
import numpy as np
from sentence_transformers import SentenceTransformer

# Load embedding model
model = SentenceTransformer('all-MiniLM-L6-v2')  # 384-dim
# OR: SentenceTransformer('all-mpnet-base-v2')    # 768-dim

# Create Faiss index
dimension = 768
index = faiss.IndexFlatIP(dimension)  # Inner product similarity

# Add movie embeddings
embeddings = np.array([movie.embedding for movie in movies])
index.add(embeddings.astype('float32'))

# Save index
faiss.write_index(index, "movie_index.faiss")
```

---

## üîå FastAPI + MCP Integration

### Core API Routes
| Path | Verb | Purpose | MCP Integration |
|------|------|---------|-----------------|
| `/api/start` | POST | Kick off 4-agent debate | Emits `session.start` MCP event |
| `/api/events/{sessionId}` | GET (SSE) | Stream MCP events | Native MCP event forwarding |
| `/api/status/{sessionId}` | GET | Session snapshot | Queries MCP session store |
| `/api/embed` | POST | Add new movie to index | Updates Faiss index + MCP tools |

### MCP Tool Definitions (REQUIRED)
```python
# app/mcp_tools/vector_search.py
from langchain.tools import BaseTool
from mcp import MCPTool

class FaissVectorSearchTool(BaseTool, MCPTool):
    name = "vector_search"
    description = "Search movies by embedding similarity"
    
    def _run(self, query: str) -> List[Movie]:
        # Embed query
        query_embedding = self.embedding_model.encode([query])
        
        # Search Faiss index
        scores, indices = self.faiss_index.search(
            query_embedding.astype('float32'), k=5
        )
        
        # Emit MCP event
        self.emit_mcp_event({
            "type": "tool.call",
            "tool": "vector_search",
            "query": query,
            "results": len(indices[0])
        })
        
        return [self.movies[i] for i in indices[0]]
```

---

## ü§ñ LangChain Agent Architecture (REQUIRED)

### 1. Profile Chain
```python
# app/chains/profile_chain.py
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate
from langchain_openai import ChatOpenAI

profile_prompt = PromptTemplate(
    input_variables=["name", "age", "favorite_films", "vibe"],
    template="""
    Create a JSON profile for movie recommendation:
    Name: {name}
    Age: {age}
    Favorite Films: {favorite_films}
    Tonight's Vibe: {vibe}
    
    Return JSON with: {{
        "personality": "...",
        "preferred_genres": [...],
        "energy_level": "high/medium/low",
        "group_dynamics": "leader/follower/mediator/rebel"
    }}
    """
)

profile_chain = LLMChain(
    llm=ChatOpenAI(model="gpt-4"),
    prompt=profile_prompt,
    output_parser=JsonOutputParser()
)
```

### 2. Multi-Agent Debate Orchestrator
```python
# app/agents/orchestrator.py
from langchain.agents import initialize_agent, Tool
from langchain.agents import AgentType
from langchain_openai import ChatOpenAI

class DebateOrchestrator:
    def __init__(self):
        self.llm = ChatOpenAI(model="gpt-4")
        self.agents = []
        self.mcp_events = []
        
        # Initialize 4 lawyer agents
        for i in range(4):
            agent = initialize_agent(
                tools=[
                    FaissVectorSearchTool(),
                    OpenAIChatTool(),
                    TimerGuardTool()
                ],
                llm=self.llm,
                agent=AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION,
                verbose=True
            )
            self.agents.append(agent)
    
    async def run_debate(self, profiles: List[dict]) -> str:
        # Round-robin pairing logic
        # Each pair debates and eliminates movies
        # Stream all thoughts via MCP events
        pass
```

---

## üé® Frontend: Magic MCP Heavy Integration

### Magic MCP Component Generation
Use Magic MCP in Cursor to generate these components:

1. **Generate MagicCard Component**:
   ```
   /magic create a card component with:
   - Dark theme with gradient border
   - Avatar placeholder
   - Profile summary text
   - Click handler for modal
   - Framer Motion spring animations
   ```

2. **Generate UserModal**:
   ```
   /magic create a modal dialog with:
   - Name, age, favorite films inputs
   - "Tonight's vibe" textarea
   - Save/cancel buttons
   - Form validation
   - Tailwind dark styling
   ```

3. **Generate ToastProvider**:
   ```
   /magic create a toast system with:
   - Round begin/end notifications
   - Color-coded by round type
   - Auto-dismiss after 3 seconds
   - Slide-in animations
   ```

### Event Streaming Hook
```typescript
// hooks/useEventSource.ts
export function useEventSource(sessionId: string) {
  const [events, setEvents] = useState<MCPEvent[]>([]);
  
  useEffect(() => {
    const eventSource = new EventSource(
      `/api/events/${sessionId}`
    );
    
    eventSource.onmessage = (event) => {
      const mcpEvent = JSON.parse(event.data);
      setEvents(prev => [...prev, mcpEvent]);
      
      // Handle different MCP event types
      switch(mcpEvent.type) {
        case 'agent.thought':
          // Update agent stream
          break;
        case 'round.begin':
          // Show toast
          break;
        case 'consensus.reached':
          // Show final result
          break;
      }
    };
    
    return () => eventSource.close();
  }, [sessionId]);
  
  return events;
}
```

---

## üê≥ Docker Compose Setup

```yaml
# docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - MCP_HOST=http://backend:8000
      - FAISS_INDEX_PATH=/app/data/movie_index.faiss
    volumes:
      - ./data:/app/data
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000
      - NEXT_PUBLIC_MCP_WS=http://localhost:8000/api/events
    depends_on:
      - backend
    command: pnpm start

volumes:
  faiss-data:
```

### Environment Variables (.env.example)
```bash
# OpenAI API (required for LangChain)
OPENAI_API_KEY=sk-...

# MCP Configuration
MCP_HOST=http://backend:8000
MCP_DEBUG=true

# Frontend URLs
NEXT_PUBLIC_API_URL=http://localhost:8000
NEXT_PUBLIC_MCP_WS=http://localhost:8000/api/events

# Faiss Configuration
FAISS_INDEX_PATH=/app/data/movie_index.faiss
EMBEDDING_MODEL=all-mpnet-base-v2
```

---

## ‚è±Ô∏è 3-Hour Sprint Breakdown

| **Time** | **Deliverable** | **Magic MCP Usage** |
|----------|-----------------|-------------------|
| **00‚Äì30 min** | Repo structure, docker-compose boot, FastAPI "hello" | Generate basic FastAPI structure |
| **30‚Äì60** | MCP event streaming, SSE endpoint, EventSource connection | Generate event streaming components |
| **60‚Äì90** | **Heavy Magic MCP**: Generate all UI components (Cards, Modal, Toast) | Generate 4 complete UI components |
| **90‚Äì120** | Faiss index build, LangChain vector search tool, MCP wrapper | Generate tool wrappers |
| **120‚Äì150** | LangChain agents, debate pairing, elimination chains | Generate agent orchestration logic |
| **150‚Äì165** | UI polish with Magic MCP animations, colored toasts | Generate final polish components |
| **165‚Äì180** | Fresh `docker compose up --build` test, demo recording | - |

---

## ‚úÖ Quality Checklist

- [ ] **`docker compose up --build` works on blank machine**
- [ ] **All agent logic uses LangChain + MCP (REQUIRED)**
- [ ] **Magic MCP generated at least 4 UI components**
- [ ] **Faiss index builds and searches correctly**
- [ ] **MCP events stream to frontend in real-time**
- [ ] **4 agents can complete a full debate round**
- [ ] **Frontend reconnects gracefully via `/api/status`**
- [ ] **README includes port map and quick start**

---

## üöÄ Magic MCP Acceleration Tips

1. **Use Magic MCP for ALL UI components** - don't hand-code anything
2. **Generate component variations** - `/magic variant dark theme` for styling
3. **Auto-generate API client code** - `/magic api client for FastAPI`
4. **Component composition** - `/magic compose card + modal + animation`
5. **Real-time updates** - `/magic websocket component for events`

---

### Ready to ship! 

**One command deployment** ‚úÖ  
**LangChain + MCP architecture** ‚úÖ  
**Magic MCP heavy integration** ‚úÖ  
**Facebook AI Faiss (free vectors)** ‚úÖ  

Let the lawyer-agents debate, stream their thoughts live, and deliver that consensus movie recommendation. üé¨‚ú®